<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
        rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
        crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
          crossorigin="anonymous"></script>
  <title>회원가입</title>
  <style>
    .container {
      margin-top: 100px;
    }

    .btn-primary {
      background-color: #1aafec;
      border-color: #1aafec;
    }

    .btn-primary:hover {
      background-color: #439cb9;
      border-color: #439cb9;
    }

    .mainLogo {
      color: #1aafec;
    }

    .error-msg {
      color: #dc3545;
    }

  </style>
</head>
<body>
<div class="container">
  <div class="row justify-content-center">
    <div class="col-md-4 col-lg-4">
      <h1 class="logo_sky">
        <a class="link text-decoration-none">
          <span class="mainLogo blind" th:text="#{sky.logo}"></span>
        </a>
      </h1>
      <form method="post" th:object="${userJoinDto}">
        <div class="form-group">
          <label th:for="userId">아이디</label>
          <input type="text" class="form-control" th:field="*{userId}"
                 placeholder="아이디를 입력하세요" th:errorclass="border-danger">
          <div class="form-text text-danger">
            <th:block th:if="${#fields.hasErrors('userId')}"
                      th:each="err : ${#fields.detailedErrors('userId')}">
              <small th:if="${errStat.size > 1 && err.getCode() == 'NotBlank'}"
                     th:text="${err.getMessage()}"></small>
              <small th:if="${errStat.size == 1 && err.getCode() == 'Pattern'}"
                     th:text="${err.getMessage()}"></small>
            </th:block>
          </div>
        </div>
        <div class="form-group">
          <label th:for="password">비밀번호</label>
          <input type="password" th:field="*{password}" class="form-control"
                 th:errorclass="border-danger"
                 placeholder="비밀번호를 입력하세요">
          <div class="form-text text-danger">
            <th:block th:if="${#fields.hasErrors('password')}"
                      th:each="err : ${#fields.detailedErrors('password')}">
              <small th:if="${errStat.size > 1 && err.getCode() == 'NotBlank'}"
                     th:text="${err.getMessage()}"></small>
              <small th:if="${errStat.size == 1 && err.getCode() == 'Pattern'}"
                     th:text="${err.getMessage()}"></small>
            </th:block>
          </div>
        </div>

        <div class="form-group">
          <label th:for="userName">닉네임</label>
          <input class="form-control" th:field="*{userName}"
                 placeholder="닉네임을 입력하세요" th:errorclass="border-danger">
          <div class="form-text text-danger">
            <th:block th:if="${#fields.hasErrors('userName')}"
                      th:each="err : ${#fields.detailedErrors('userName')}">
              <small th:if="${errStat.size > 1 && err.getCode() == 'NotBlank'}"
                     th:text="${err.getMessage()}"></small>
              <small th:if="${errStat.size == 1 && err.getCode() == 'Pattern'}"
                     th:text="${err.getMessage()}"></small>
            </th:block>
          </div>
        </div>
        <div class="form-group">
          <label th:for="notification_enabled">이메일</label>
          <div class="input-group">
            <input class="form-control" th:field="*{email}" placeholder="이메일을 입력하세요">
            <div class="input-group-append">
              <button type="button" class="btn btn-primary" id="sendCodeButton">인증번호 전송</button>
            </div>
          </div>
          <small id="email-authTime" class="form-text ">인증 유효시간: 5분</small>
          <th:block th:if="${#fields.hasErrors('email')}"
                    th:each="err : ${#fields.detailedErrors('email')}">
            <small th:if="${errStat.size > 1 && err.getCode() == 'NotBlank'}"
                   th:text="${err.getMessage()}"></small>
            <small th:if="${errStat.size == 1 && err.getCode() == 'Pattern'}"
                   th:text="${err.getMessage()}"></small>
          </th:block>
        </div>
        <div class="form-group">
          <label for="verification-code">인증번호 확인</label>
          <div class="input-group">
            <input type="text" class="form-control" id="verification-code"
                   placeholder="인증번호를 입력하세요">
            <div class="input-group-append">
              <button type="button" class="btn btn-primary" id="verifyCodeButton">인증번호 확인</button>
            </div>
          </div>
          <small id="verification-time" class="form-text">인증 유효시간: 5분</small>
          <small id="verification-email-error" class="form-text" style="color: red">sdgdsgd</small>
        </div>

        <div class="form-group form-check">
          <input class="form-check-input" th:field="*{notification_enabled}" type="checkbox"
                 value="">
          <label class="form-check-label" th:for="notification_enabled">
            Indeterminate checkbox
          </label>
        </div>


        <button type="submit" class="btn btn-primary btn-block btn-dark">가입하기</button>
      </form>
    </div>
  </div>
</div>

<script th:inline="javascript">
  const $password = document.getElementById("password");
  const rePw = [[${rePw}]];
  let emailDto;
  let errorResult;
  $password.value = rePw;

  function sendAuthCodeButton() {
    const $email = document.getElementById("email");

    const emailVal = $email.value;
    fetch("/email/join", {
      method: 'POST',
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({email: emailVal})
    })
    .then((response) => {
          if (response.ok) {
            response.json().then(data => {
              emailDto = data;
            });
          } else {
            response.json().then(data => {
              errorResult = data
              throw new Error("error");
            });
          }
        }
    ).catch(() => {

    });
  }

  document.getElementById("sendCodeButton").onclick = function () {
    sendAuthCodeButton();
  };

</script>


<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"
        integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js"
        integrity="sha384-cuYeSxntonz0PPNlHhBs68uyIAVpIIOZZ5JqeqvYYIcEL727kskC66kF92t6Xl2V"
        crossorigin="anonymous"></script>
</body>
</html>